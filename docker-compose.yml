version: '3.8'

services:
  flower_server:
    build:
      context: .
      dockerfile: Dockerfile.server
    container_name: flower_server
    ports:
      - "8080:8080" # Flower server communication port
    volumes:
      - ./backend:/app/backend # Mount backend code for easier development (optional for final image)

  hospital_1_client:
    build:
      context: .
      dockerfile: Dockerfile.client
    container_name: hospital_1_client
    environment:
      - HOSPITAL_ID=hospital_1
    volumes:
      - ./backend:/app/backend # Mount backend code
      - ./data/hospital_1:/app/data/hospital_1:ro # Mount specific hospital data (read-only)
    depends_on:
      - flower_server
    # Ensure clients can connect to the server's name
    extra_hosts:
      - "localhost:host-gateway" # Allows localhost:8080 to map to host's 8080 for connection from client to server if needed.

  hospital_2_client:
    build:
      context: .
      dockerfile: Dockerfile.client
    container_name: hospital_2_client
    environment:
      - HOSPITAL_ID=hospital_2
    volumes:
      - ./backend:/app/backend
      - ./data/hospital_2:/app/data/hospital_2:ro
    depends_on:
      - flower_server
    extra_hosts:
      - "localhost:host-gateway" # Same as above